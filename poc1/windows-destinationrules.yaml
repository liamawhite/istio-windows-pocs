# DestinationRules for Windows Gateway mTLS Routing
# These rules configure mTLS behavior for traffic through the Windows gateway

# Rule 1: Linux services to Windows gateway (mTLS required)
# This ensures Linux sidecars use mTLS when connecting to the Windows gateway
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: windows-gateway-mtls
  namespace: poc1
spec:
  host: poc1-windows-gateway.poc1.svc.cluster.local
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL  # Linux sidecars use mTLS to reach Windows gateway

---
# Rule 2: Windows service access (disable direct mTLS)
# This removes the previous rule that forced mTLS to Windows service directly
# Now traffic should go through the gateway instead
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: windows-service-via-gateway
  namespace: poc1
spec:
  host: windows.poc1.svc.cluster.local
  trafficPolicy:
    tls:
      mode: DISABLE  # No direct mTLS to Windows service - must go through gateway